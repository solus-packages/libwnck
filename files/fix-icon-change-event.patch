From 5efbec645cd66577c53589d426fa6205e2aded8f Mon Sep 17 00:00:00 2001
From: xuzhen <xuzhen@fastmail.com>
Date: Sun, 21 Oct 2018 15:34:55 +0800
Subject: [PATCH] Update class group icon when window icon was changed. Fixed
 Issue #135

---
 libwnck/class-group.c | 8 ++++----
 libwnck/class-group.h | 2 ++
 libwnck/window.c      | 2 ++
 3 files changed, 8 insertions(+), 4 deletions(-)

diff --git a/libwnck/class-group.c b/libwnck/class-group.c
index ef0adce..e37a0fa 100644
--- a/libwnck/class-group.c
+++ b/libwnck/class-group.c
@@ -400,8 +400,8 @@ get_icons_from_windows (WnckClassGroup *class_group, GdkPixbuf **icon, GdkPixbuf
 /* Gets a sensible icon and mini_icon for the class group from the application
  * group leaders or from individual windows.
  */
-static void
-set_icon (WnckClassGroup *class_group)
+void
+_wnck_class_group_set_icon (WnckClassGroup *class_group)
 {
   GdkPixbuf *icon, *mini_icon;
   gboolean icons_reffed = FALSE;
@@ -464,7 +464,7 @@ _wnck_class_group_add_window (WnckClassGroup *class_group,
   _wnck_window_set_class_group (window, class_group);
 
   set_name (class_group);
-  set_icon (class_group);
+  _wnck_class_group_set_icon (class_group);
 
   /* FIXME: should we monitor class group changes on the window?  The ICCCM says
    * that clients should never change WM_CLASS unless the window is withdrawn.
@@ -492,7 +492,7 @@ _wnck_class_group_remove_window (WnckClassGroup *class_group,
   _wnck_window_set_class_group (window, NULL);
 
   set_name (class_group);
-  set_icon (class_group);
+  _wnck_class_group_set_icon (class_group);
 }
 
 /**
diff --git a/libwnck/class-group.h b/libwnck/class-group.h
index ce084c3..08dfaa9 100644
--- a/libwnck/class-group.h
+++ b/libwnck/class-group.h
@@ -89,4 +89,6 @@ const char * wnck_class_group_get_res_class (WnckClassGroup *class_group);
 
 G_END_DECLS
 
+void _wnck_class_group_set_icon (WnckClassGroup *class_group);
+
 #endif /* WNCK_CLASS_GROUP_H */
diff --git a/libwnck/window.c b/libwnck/window.c
index 315bf67..6f46076 100644
--- a/libwnck/window.c
+++ b/libwnck/window.c
@@ -3383,6 +3383,8 @@ emit_icon_changed (WnckWindow *window)
   g_signal_emit (G_OBJECT (window),
                  signals[ICON_CHANGED],
                  0);
+  if (window->priv->class_group != NULL)
+    _wnck_class_group_set_icon(window->priv->class_group);
 }
 
 static void
-- 
2.18.1

